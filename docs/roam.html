<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-04-27 Mon 09:29 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ZIO ROAM</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Brett Viren" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="org.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">ZIO ROAM</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org94bdc91">1. Protocol</a></li>
<li><a href="#orgd461d35">2. Patterns</a>
<ul>
<li><a href="#orgc112616">2.1. Classroom</a></li>
<li><a href="#org57a2cf3">2.2. Restaurant</a></li>
<li><a href="#org1eb7c2b">2.3. Seeger</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="nav">
<ul class="org-ul">
<li><a href="index.html">Main Page</a></li>
<li><a href="install.html">Installation</a></li>
<li><a href="tutorial.html">Tutorials</a></li>
<li><a href="examples.html">Examples</a></li>
<li><a href="whytos.html">Design documents</a></li>
<li><a href="api.html">API Reference</a></li>
</ul>

</div>

<p>
There are many RPC systems.  Here is mine.
</p>

<div id="outline-container-org94bdc91" class="outline-2">
<h2 id="org94bdc91"><span class="section-number-2">1</span> Protocol</h2>
<div class="outline-text-2" id="text-1">
<p>
The ZIO remote object access method (ROAM) is an asynchronous,
(mostly) symmetric and reliable protocol which allows one peer to
issue a query on another and to receive a response.  It is
asynchronous in that queries and responses may interleave and not
retain order.  It is symmetric in that once a link between endpoints
are established (which may be asymmetric) either end may initiate a
query (as required by the system application).  It is reliable in the
sense that an endpoint may discover if its cohort has become
unresponsive and thus may abandon the conversation.
</p>

<p>
When the query is interpreted as a request to execute some method or
procedure on some object held by the remote endpoint then the response
is considered to be the return value of that method.  Thus the ZIO
ROAM protocol can be seen as a generalization the more common and
typically more restrictive remote procedure call (RPC) communication
pattern.  ROAM can simplify to RPC.
</p>

<p>
Being part of ZIO, ROAM uses the <a href="messages.html">ZIO message</a> for exchanging data.  The
four byte message <i>form</i> is not surprisingly <code>ROAM</code>.  Like the ZIO <a href="flow.html">flow</a>
protocol, the label holds a JSON-encoded object.  All ZIO ROAM
messages must include a label object attribute <code>roam</code> to hold the value
of one of the ROAM message types listed below.  Additional label
object attributes are required depending on the ROAM message type,
also in the message type list below.
</p>

<p>
The prefix header is also required as part of the ZIO ROAM protocol as
defined:
</p>

<dl class="org-dl">
<dt><code>seqno</code></dt><dd>shall hold the count of ZIO ROAM messages that have been sent prior to the current message from the given application socket.</dd>
<dt><code>granule</code></dt><dd>shall hold the local time as determined by the sender and
in an application-depended clock (eg, microseconds from Unix epoch).</dd>
<dt><code>origin</code></dt><dd>may be used in an application-dependent manner.</dd>
</dl>

<p>
The message payload parts are not strictly required by the ZIO ROAM
protocol and their use is application-dependent.  It is expected that
applications will use them to hold data to be interpreted as method
arguments or method return values by the ZIO ROAM endpoint applications.
</p>

<p>
The ZIO ROAM protocol has three message types.  The type is identified
by the <code>roam</code> label object attribute value.
</p>

<dl class="org-dl">
<dt>BEAT</dt><dd>a heartbeat message to be sent periodically at a
predetermined rate in both directions.  An endpoint application may
elect to terminate further conversation with its cohort if no
messages are received within the predefined period.  BEAT may be
used to refresh this deadline if no other messages need be sent.</dd>

<dt>CALL</dt><dd>a remote method call.  Additional label object attributes
are required: a <code>callid</code> must provide unique identifier of type string
and a <code>query</code> attribute of type string must provide the name of a
query, command, procedure, etc, to execute on the remote object.
Additional application-dependent attributes may be included.</dd>

<dt>BACK</dt><dd>a result of a call.  Additional label object attributes are
required: a <code>callid</code> must provide the unique identifier sent with the
corresponding CALL.  A <code>status</code> attribute shall hold an integer code
with semantic meaning taken from HTTP status codes and include at
least 200 (OK).</dd>
</dl>
</div>
</div>

<div id="outline-container-orgd461d35" class="outline-2">
<h2 id="orgd461d35"><span class="section-number-2">2</span> Patterns</h2>
<div class="outline-text-2" id="text-2">
<p>
As mentioned, the ZIO ROAM protocol is "mostly" symmetric.  ZeroMQ
sockets require some level of asymmetry.  For example, clientish
sockets (CLIENT/DEALER) must send before serverish (SERVER/ROUTER) may
reply.  That initial message may be provided by a clientish endpoint
by sending a BEAT or if applicable a CALL.  After that, the two
endpoints are considered to be "linked" and fully symmetric
conversation may follow.
</p>

<p>
Other ZeroMQ sockets are very asymmetric in that they allow only send
or recv but not both.  The ZIO RPC protocol may still be used but it
requires then a pair of sockets, one for each directions.
</p>

<p>
Thus the ZIO ROAM protocol may be with a variety of socket patterns
based on the needs of the applications.  This section describes some
compatible patterns which emerge.
</p>
</div>

<div id="outline-container-orgc112616" class="outline-3">
<h3 id="orgc112616"><span class="section-number-3">2.1</span> Classroom</h3>
<div class="outline-text-3" id="text-2-1">

<div class="figure">
<p><img src="roam-classroom.png" alt="roam-classroom.png" />
</p>
</div>

<p>
The ZIO ROAM classroom model is intended for applications that require
communication between a central "teacher" and multiple "students".  A
student may make a CALL on the teacher ("ask a question") and the
teacher may make a CALL on a student ("give instruction").
</p>

<p>
The classroom model is implemented with a single SERVER socket for the
"teacher".  It binds and to it many CLIENT sockets ("students")
connect.  A student may send BEAT or CALL at any time.  A teacher may
send BEAT or CALL to a particular student any time after at least one
BEAT or one CALL from that student was received.
</p>

<p>
A student may simultaneously be in multiple "classrooms" by connecting
to multiple teachers' SERVER sockets.  Such a student must maintain a
unique CLIENT socket for each in order to properly address a teacher.
</p>
</div>
</div>


<div id="outline-container-org57a2cf3" class="outline-3">
<h3 id="org57a2cf3"><span class="section-number-3">2.2</span> Restaurant</h3>
<div class="outline-text-3" id="text-2-2">

<div class="figure">
<p><img src="roam-restaurant.png" alt="roam-restaurant.png" />
</p>
</div>

<p>
The ZIO ROAM restaurant model is intended for applications that
require some redundancy.  It leverages the round-robin distribution
pattern provided by some ZeroMQ sockets.
</p>

<p>
The restaurant model is implemented with a number of SERVER sockets
(each a "waiter") which bind and with a (presumably larger) number of
CLIENT sockets (each a "diner") which connect.  The waiters are
considered identical from the point of view of their connected diners.
</p>

<p>
A diner may send a BEAT or CALL at any time and does not know which
connected waiter receives it.  A waiter may send a BEAT or CALL to a
particular diner any time after at least one BEAT or one CALL from
that diner has been received.
</p>


<p>
Not drawn, but like with the classroom model, a diner may have
multiple CLIENT sockets in order to simultaneously "dine" at more than
one restaurant.
</p>
</div>
</div>

<div id="outline-container-org1eb7c2b" class="outline-3">
<h3 id="org1eb7c2b"><span class="section-number-3">2.3</span> Seeger</h3>
<div class="outline-text-3" id="text-2-3">

<div class="figure">
<p><img src="roam-seeger.png" alt="roam-seeger.png" />
</p>
</div>

<p>
The ZIO ROAM seeger model is intended for applications where one
individual ("singer") will make a CALL to a "crowd" of peers ("If I
had a hammer") and the crowd will send BACK ("I'd hammer in the
morning").  The crowd may be very large in number and/or it may not be
possible to precisely know each individual or otherwise it may be
deemed inconvenient to maintain individual routing IDs needed for use
of a SERVER socket.  Further, it may be that the central "singer" is
well known to all in the crowd.
</p>

<p>
In this pattern the singer will bind one PUB and one PULL socket.
Each peer in the crowd will connect to these a SUB and a PUSH,
respectively.  The singer will send BEAT and CALL out the PUB and
expect BEAT and BACK on the PULL.  Each in the crowd will receive BEAT
and CALL on their SUB and send BEAT and BACK on their PUSH.
</p>

<p>
PUB to SUB and PUSH to PULL both allow one way transports and thus
implementations of ZIO RPC must not assume one socket for both
directions.  PUB/SUB can drop packets if HWM is reached and in any
case the singer does not know the crowd individuals and thus some in
the crowd should expect to miss BEAT or CALL messages and the singer
should expect to not receive BEAT and BACK from some individuals some
of the time.
</p>
</div>
</div>
</div>
</div>
</body>
</html>
